@startuml
' hide the spot
' hide circle
skinparam linetype ortho

entity "Invoice" as invoice {
  *invoice_id : UUID <<PK>>
  --
  *subscription_id: UUID <<FK>>
  *invoice_dt : datetime
  *created: datetime
  *modified: datetime
  *price: int
}

entity "Subscription" as subscription {
  *id: UUID <<PK>>
  --
  *plan_id: UUID <<FK>>
  *user_id: UUID
  *status: text
  *start_dt: datetime
  *end_dt: datetime
  *created: datetime
  *modified: datetime
}

entity "Plan" as plan {
  *id : UUID <<PK>>
  --
  *name: text
  *description: text
  *is_active: bool
  *is_recurring: bool
  *created: datetime
  *modified: datetime
  *duration: int
  *duration_unit: int
  *price_per_unit: int
  *price: int
}


entity "Payment" as payment {
  *id: UUID <<PK>>
  --
  *invoice_id: UUID <<FK>>
  *provider_id: UUID <<FK>>
  *status: text
  *value: number
  *currency: text
  *created: datetime
  *modified: datetime
}


entity "PaymentProvider" as provider {
  *id : UUID <<PK>>
  --
  *name: text
  *description: text
  *is_active: bool
  *created: datetime
  *modified: datetime
}


entity "Feature" as feature{
  *id: UUID <<PK>>
  --
  *name: text
  *description: text
  *created: datetime
  *modified: datetime
  *available_entities: jsonb
}


entity "PlanFeatures" as plan_features {
  *id: UUID <<generated>>
  --
  *plan_id: UUID <<FK>>
  *feature_id: UUID <<FK>>
}

invoice ||-up-|| subscription
subscription }|-up-|| plan
invoice ||--|{ payment
payment }|-left-|| provider
plan ||-left-|{ plan_features
plan_features }|-left-|| feature
@enduml